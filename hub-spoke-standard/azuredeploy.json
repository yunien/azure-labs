{
    "$schema": "https://schema.management.azure.com/schemas/2018-05-01/subscriptionDeploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "envName": {
            "type": "string",
            "metadata": {
                "description": "env"
            }
        },
        "suffix": {
            "type": "string",
            "metadata": {
                "description": "suffix string"
            }
        },
        "tags": {
            "type": "object",
            "metadata": {
                "description": "The tags that wil be associated to the resources"
            },
            "defaultValue": {
                "environment": "lab",
                "creater": "electrum"
            }
        },
        "location": {
            "type": "string",
            "metadata": {
                "description": "Location of the resource group"
            },
            "defaultValue": "[deployment().location]"
        },
        "transitVnetCidr": {
            "type": "string",
            "metadata": {
                "description": "description"
            }
        },
        "transitGatewaySubnetCidr": {
            "type": "string",
            "metadata": {
                "description": "description"
            }
        },
        "transitBastionSubnetCidr": {
            "type": "string",
            "metadata": {
                "description": "description"
            }
        },
        "transitFwSubnetCidr": {
            "type": "string",
            "metadata": {
                "description": "description"
            }
        }
    },
    "variables": {
        "makeSuffix": "[concat(parameters('envName'),'-',parameters('location'),'-',parameters('suffix'))]",
        "transitDeploymentName": "[concat('deploy-transit-',variables('makeSuffix'))]",
        "transitTemplateUrl": "[uri(deployment().properties.templateLink.uri, 'templateLink/transitdeploy.json')]"
    },
    "resources": [
        {
            "type": "Microsoft.Resources/resourceGroups",
            "apiVersion": "2021-04-01",
            "name": "[concat('rg-transit-',parameters('envName'),'-',parameters('location'),'-',parameters('suffix'))]",
            "location": "[parameters('location')]",
            "properties": {}
        },
        {
            "type": "Microsoft.Resources/deployments",
            "apiVersion": "2021-04-01",
            "name": "[variables('transitDeploymentName')]",
            "resourceGroup": "[concat('rg-transit-',parameters('envName'),'-',parameters('location'),'-',parameters('suffix'))]",
            "dependsOn": [
                "[resourceId('Microsoft.Resources/resourceGroups', concat('rg-transit-',parameters('envName'),'-',parameters('location'),'-',parameters('suffix')))]"
            ],
            "properties": {
                "mode": "Incremental",
                "templateLink": {
                    "uri": "[variables('transitTemplateUrl')]",
                    "contentVersion": "1.0.0.0"
                },
                "parameters": {
                    "tags": {
                        "value": "[parameters('tags')]"
                    },
                    "location": {
                        "value": "[parameters('location')]"
                    },
                    "makeSuffix": {
                        "value": "[variables('makeSuffix')]"
                    },
                    "transitVnetCidr": {
                        "value": "[parameters('transitVnetCidr')]"
                    },
                    "transitGatewaySubnetCidr": {
                        "value": "[parameters('transitGatewaySubnetCidr')]"
                    },
                    "transitBastionSubnetCidr": {
                        "value": "[parameters('transitBastionSubnetCidr')]"
                    },
                    "transitFwSubnetCidr": {
                        "value": "[parameters('transitFwSubnetCidr')]"
                    }
                }
                // "template": {
                //     "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                //     "contentVersion": "1.0.0.0",
                //     "parameters": {},
                //     "variables": {},
                //     "resources": [
                //         {
                //             "type": "Microsoft.Storage/storageAccounts",
                //             "apiVersion": "2021-04-01",
                //             "name": "[variables('storageName')]",
                //             "location": "[parameters('transitRegion')]",
                //             "sku": {
                //                 "name": "Standard_LRS"
                //             },
                //             "kind": "Storage",
                //             "properties": {
                //             }
                //         },
                //         {
                //             "type": "Microsoft.OperationalInsights/workspaces",
                //             "apiVersion": "2021-12-01-preview",
                //             "name": "[variables('lawDeploymentName')]",
                //             "location": "[parameters('transitRegion')]",
                //             "tags": "[parameters('tags')]",
                //             "properties": {
                //                 "publicNetworkAccessForIngestion": "Enabled",
                //                 "publicNetworkAccessForQuery": "Enabled",
                //                 "retentionInDays": 30,
                //                 "sku": {
                //                     "name": "PerGB2018"
                //                 },
                //                 "workspaceCapping": {
                //                     "dailyQuotaGb": 1
                //                 }
                //             }
                //         }
                //     ]
                // }
            }
        }
        // {
        //     "type": "Microsoft.Resources/deployments",
        //     "apiVersion": "2021-04-01",
        //     "name": "[variables('transitDeploymentName')]",
        //     "resourceGroup": "[concat('rg-transit-',parameters('envName'),'-',parameters('location'),'-',parameters('suffix'))]",
        //     "dependsOn": [
        //         "[resourceId('Microsoft.Resources/resourceGroups', concat('rg-transit-',parameters('envName'),'-',parameters('location'),'-',parameters('suffix')))]"
        //     ],
        //     "properties": {
        //         "mode": "Incremental",
        //         "templateLink": {
        //             "uri": "[variables('transitTemplateUrl')]",
        //             "contentVersion": "1.0.0.0"
        //         },
        //         "parameters": {
        //             "makeSuffix": {
        //                 "value": "[variables('makeSuffix')]"
        //             },
        //             "location": {
        //                 "value": "[parameters('location')]"
        //             },
        //             "tags": {
        //                 "value": "[parameters('tags')]"
        //             }
        //         }
        //         // "template": {
        //         //     "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
        //         //     "contentVersion": "1.0.0.0",
        //         //     "parameters": {},
        //         //     "variables": {},
        //         //     "resources": [
        //         //         {
        //         //             "type": "Microsoft.Storage/storageAccounts",
        //         //             "apiVersion": "2021-04-01",
        //         //             "name": "[variables('storageName')]",
        //         //             "location": "[parameters('transitRegion')]",
        //         //             "sku": {
        //         //                 "name": "Standard_LRS"
        //         //             },
        //         //             "kind": "Storage",
        //         //             "properties": {
        //         //             }
        //         //         },
        //         //         {
        //         //             "type": "Microsoft.OperationalInsights/workspaces",
        //         //             "apiVersion": "2021-12-01-preview",
        //         //             "name": "[variables('lawDeploymentName')]",
        //         //             "location": "[parameters('transitRegion')]",
        //         //             "tags": "[parameters('tags')]",
        //         //             "properties": {
        //         //                 "publicNetworkAccessForIngestion": "Enabled",
        //         //                 "publicNetworkAccessForQuery": "Enabled",
        //         //                 "retentionInDays": 30,
        //         //                 "sku": {
        //         //                     "name": "PerGB2018"
        //         //                 },
        //         //                 "workspaceCapping": {
        //         //                     "dailyQuotaGb": 1
        //         //                 }
        //         //             }
        //         //         }
        //         //     ]
        //         // }
        //     }
        // }
    ],
    "outputs": {
        "transitResourceGroupName": {
            "type": "string",
            "value": "[concat('rg-transit-',parameters('envName'),'-',parameters('location'),'-',parameters('suffix'))]"
        }
    }
}
